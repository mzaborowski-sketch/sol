<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Instrukcja â€“ konfigurator trybÃ³w baterii G13/G14</title>
  <meta name="theme-color" content="#0ea5e9">
  <link rel="stylesheet" href="assets/css/metro.css">
</head>
<body class="accent-green has-floating">
<main class="container tight">

  <div class="floating-menu">
    <a href="index.html" title="PowrÃ³t do menu">
      <span class="label">MENU</span>
      <span class="emoji">ğŸ </span>
    </a>
  </div>

  <section class="hero">
    <div class="kicker">Instrukcja</div>
    <h1>Konfigurator trybÃ³w pracy baterii (G13/G14)</h1>
    <p>
      Ten dokument opisuje dziaÅ‚anie graficznego edytora
      <code>battery_modes_g14_gui.py</code>, ktÃ³ry sÅ‚uÅ¼y do ustawiania
      parametrÃ³w pracy instalacji PV z magazynem energii i inwerterem Solax.
      Program edytuje plik INI, z ktÃ³rego pÃ³Åºniej korzysta skrypt
      <code>utility_03_set_up_solax_g14.py</code>, wybierajÄ…c tryb pracy
      (normalny, arbitraÅ¼owy, Å‚adowanie) i budujÄ…c komendy wysyÅ‚ane do inwertera.
    </p>
  </section>

  <section class="content">
    <h2>1. Co robi ten program?</h2>
    <p>
      Graficzny konfigurator:
    </p>
    <ul>
      <li>otwiera i edytuje plik INI z ustawieniami logiki sterowania bateriÄ…,</li>
      <li>umoÅ¼liwia wybÃ³r aktywnej taryfy (<code>g13</code> / <code>g14</code>),</li>
      <li>pozwala zdefiniowaÄ‡ trzy tryby pracy:
        <strong>NORMAL</strong>, <strong>ARBITRAÅ»</strong>, <strong>ÅADOWANIE</strong>,</li>
      <li>ustawia progi cenowe i zasady przeÅ‚Ä…czania miÄ™dzy trybami,</li>
      <li>wÅ‚Ä…cza / wyÅ‚Ä…cza automatyczne wysyÅ‚anie komend do Solaxa (<code>send_to_solax</code>).</li>
    </ul>
    <p>
      Sam program <strong>nie wysyÅ‚a</strong> jeszcze komend do inwertera. Robi to
      dopiero skrypt automatyzujÄ…cy (<code>utility_03_set_up_solax_g14.py</code>),
      ktÃ³ry:
    </p>
    <ol>
      <li>czyta ceny energii z pliku CSV (G13 / G14),</li>
      <li>na podstawie INI wybiera, ktÃ³ry tryb ma obowiÄ…zywaÄ‡ w aktualnym slocie czasowym,</li>
      <li>buduje listÄ™ rejestrÃ³w <code>reg=val</code>,</li>
      <li>zapisuje te komendy do CSV i do <code>odczyty.csv</code>,</li>
      <li>opcjonalnie wysyÅ‚a je do chmury Solax (jeÅ›li <code>send_to_solax = true</code>).</li>
    </ol>

    <h2>2. Gdzie jest plik INI i jak uruchomiÄ‡ GUI?</h2>
    <p>
      DomyÅ›lnie plik konfiguracyjny znajduje siÄ™ na NAS-ie:
    </p>
    <pre><code>\\nas\Public\python\work\utilities\utility_03_set_up_solax_g14.ini</code></pre>
    <p>
      Na komputerze z Windows warto mieÄ‡ ten katalog zamapowany jako dysk
      sieciowy lub dostÄ™pny przez UNC. Typowy sposÃ³b uruchomienia:
    </p>
    <pre><code>cd C:\qsync\pv_system\skrypty
py -3 battery_modes_g14_gui.py</code></pre>
    <p>
      Po uruchomieniu:
    </p>
    <ul>
      <li>program wczyta istniejÄ…cy INI (jeÅ›li jest),</li>
      <li>wartoÅ›ci z INI trafiÄ… do odpowiednich pÃ³l i przeÅ‚Ä…cznikÃ³w,</li>
      <li>przycisk â€Save INIâ€ zapisze wszystkie aktualne ustawienia do pliku.</li>
    </ul>

    <h2>3. Struktura zakÅ‚adek w GUI</h2>
    <p>
      GUI jest podzielone na kilka zakÅ‚adek (notebook):
    </p>
    <ul>
      <li><strong>OGÃ“LNE / LOGIKA</strong> â€“ ustawienia globalne i logika przeÅ‚Ä…czania,</li>
      <li><strong>NORMAL</strong> â€“ tryb codziennego, â€zdroworozsÄ…dkowegoâ€ uÅ¼ycia baterii,</li>
      <li><strong>ARBITRAÅ»</strong> â€“ tryb sprzedawania energii, gdy jest bardzo droga,</li>
      <li><strong>ÅADOWANIE</strong> â€“ tryb Å‚adowania baterii z sieci, gdy ceny sÄ… niskie.</li>
    </ul>
    <p>
      Wszystkie te zakÅ‚adki opisujÄ… ten sam plik INI, tylko rÃ³Å¼ne jego sekcje.
    </p>

    <h2>4. Sekcja OGÃ“LNE â€“ [general]</h2>
    <p>
      Ta sekcja zawiera ustawienia, ktÃ³re dotyczÄ… caÅ‚ego systemu, niezaleÅ¼nie
      od aktualnego trybu:
    </p>
    <ul>
      <li>
        <code>season_mode</code><br>
        SposÃ³b uwzglÄ™dniania pory roku:
        <ul>
          <li><code>auto</code> â€“ logika moÅ¼e uwzglÄ™dniaÄ‡ porÄ™ roku (w przyszÅ‚oÅ›ci),</li>
          <li><code>lato</code> â€“ wymuszenie trybu â€letniegoâ€,</li>
          <li><code>zima</code> â€“ wymuszenie trybu â€zimowegoâ€.</li>
        </ul>
        Na razie jest to bardziej parametr â€na przyszÅ‚oÅ›Ä‡â€, ale warto go ustawiÄ‡
        sensownie.
      </li>
      <li>
        <code>active_tariff</code><br>
        Aktywna taryfa zakupu energii:
        <ul>
          <li><code>g13</code> â€“ taryfa dzienna z trzema strefami czasowymi,</li>
          <li><code>g14</code> â€“ taryfa godzinowa / dynamiczna (np. RCE).</li>
        </ul>
        Skrypt cenowy wybiera odpowiednie kolumny z pliku cenowego na podstawie
        tej wartoÅ›ci.
      </li>
      <li>
        <code>hi_is</code><br>
        SposÃ³b kodowania czasu w rejestrach:
        <ul>
          <li><code>min</code> â€“ standardowe kodowanie Solax (minuty w bajcie â€highâ€),</li>
          <li><code>hour</code> â€“ alternatywne (raczej nie uÅ¼ywane w tej konfiguracji).</li>
        </ul>
        Dla bezpieczeÅ„stwa zalecane jest <strong>min</strong>.
      </li>
      <li>
        <code>debug</code><br>
        Flaga wÅ‚Ä…czajÄ…ca tryb bardziej â€gadatliwychâ€ logÃ³w. Po ustawieniu na
        <code>true</code> skrypty wypisujÄ… wiÄ™cej informacji pomocnych przy
        diagnostyce.
      </li>
      <li>
        <code>send_to_solax</code><br>
        GÅ‚Ã³wna flaga bezpieczeÅ„stwa:
        <ul>
          <li><code>false</code> â€“ skrypt <code>utility_03_set_up_solax_g14.py</code>
            <strong>tylko liczy i zapisuje</strong> komendy do plikÃ³w CSV,</li>
          <li><code>true</code> â€“ skrypt <strong>wysyÅ‚a komendy</strong> do chmury Solax
            (po wczeÅ›niejszym odczytaniu danych z <code>dane.txt</code>).</li>
        </ul>
        W praktyce zaleca siÄ™:
        <ul>
          <li>na etapie testÃ³w â€“ <code>false</code>,</li>
          <li>po sprawdzeniu logiki â€“ ostroÅ¼nie przeÅ‚Ä…czyÄ‡ na <code>true</code>.</li>
        </ul>
      </li>
    </ul>

    <h2>5. Tryby pracy â€“ NORMAL, ARBITRAÅ», ÅADOWANIE</h2>
    <p>
      KaÅ¼da z trzech zakÅ‚adek odpowiada jednej sekcji INI:
    </p>
    <ul>
      <li><strong>NORMAL</strong> â†’ <code>[mode_normal]</code></li>
      <li><strong>ARBITRAÅ»</strong> â†’ <code>[mode_arbitrage]</code></li>
      <li><strong>ÅADOWANIE</strong> â†’ <code>[mode_charge]</code></li>
    </ul>
    <p>
      Pola w tych zakÅ‚adkach sÄ… identyczne z punktu widzenia struktury â€”
      rÃ³Å¼ni siÄ™ tylko to, kiedy dany zestaw parametrÃ³w jest uÅ¼ywany.
    </p>

    <h3>5.1. Ustawienia wspÃ³lne dla wszystkich trybÃ³w</h3>
    <ul>
      <li>
        <code>work_mode</code><br>
        OgÃ³lny tryb pracy inwertera:
        <ul>
          <li><code>self_use</code> â€“ maksymalizacja autokonsumpcji, standardowy tryb,</li>
          <li><code>feed_in</code> â€“ nastawienie na oddawanie energii do sieci,</li>
          <li><code>force_charge</code> â€“ wymuszone Å‚adowanie,</li>
          <li><code>force_discharge</code> â€“ wymuszone rozÅ‚adowywanie,</li>
          <li><code>peak_shaving</code> â€“ tryb ograniczania mocy pobieranej z sieci.</li>
        </ul>
      </li>
      <li>
        <code>selling_first</code><br>
        JeÅ›li <code>true</code> â€“ instalacja â€preferujeâ€ sprzedaÅ¼ do sieci
        (tam, gdzie Solax to rozumie). Ustawienie typowe dla trybu ARBITRAÅ».
      </li>
      <li>
        <code>charge_from_grid</code><br>
        JeÅ›li <code>true</code> â€“ pozwala na <strong>Å‚adowanie baterii z sieci</strong>.
        W praktyce:
        <ul>
          <li>w NORMAL â€“ zwykle <code>false</code>,</li>
          <li>w ARBITRAÅ» â€“ zwykle <code>false</code>,</li>
          <li>w ÅADOWANIE â€“ zwykle <code>true</code>.</li>
        </ul>
      </li>
      <li>
        <code>force_mode</code><br>
        Dodatkowy â€Å‚omâ€ do wymuszenia zachowania:
        <ul>
          <li><code>none</code> â€“ brak wymuszenia,</li>
          <li><code>force_charge</code> â€“ wymuszone Å‚adowanie (reg 143),</li>
          <li><code>force_discharge</code> â€“ wymuszone rozÅ‚adowywanie.</li>
        </ul>
        UÅ¼ywaÄ‡ ostroÅ¼nie â€“ ten parametr bywa silniejszy niÅ¼ sam <code>work_mode</code>.
      </li>
      <li>
        <code>soc_min</code><br>
        Minimalny akceptowany poziom naÅ‚adowania baterii dla danego trybu.
        To jest jednoczeÅ›nie:
        <ul>
          <li>wartoÅ›Ä‡ wysyÅ‚ana do Solaxa (rejestr 141),</li>
          <li>prÃ³g, poniÅ¼ej ktÃ³rego bateria nie powinna byÄ‡ rozÅ‚adowywana.</li>
        </ul>
      </li>
      <li>
        <code>soc_target</code><br>
        Docelowy poziom naÅ‚adowania baterii w danym trybie (rejestr 144).
        W trybie ÅADOWANIE zwykle wysoki (np. 90â€“95%), w NORMAL niÅ¼szy.
      </li>
      <li>
        <code>discharge_start_hhmm</code>, <code>discharge_end_hhmm</code>,
        <code>discharge_enable</code><br>
        Okno czasowe, w ktÃ³rym dozwolone jest rozÅ‚adowywanie baterii.
        JeÅ›li <code>discharge_enable = false</code>, inwerter nie powinien
        rozÅ‚adowywaÄ‡ baterii w tym trybie (poza sytuacjami awaryjnymi).
      </li>
      <li>
        <code>charge_start_hhmm</code>, <code>charge_end_hhmm</code>,
        <code>charge_enable</code><br>
        Okno czasowe wymuszonego Å‚adowania (Force Charge Period 1).
        JeÅ›li pola czasu sÄ… puste, ten okres jest pomijany.
      </li>
    </ul>

    <h3>5.2. Logika uÅ¼ycia poszczegÃ³lnych trybÃ³w</h3>
    <ul>
      <li>
        <strong>NORMAL</strong> â€“ â€codziennyâ€ tryb pracy:
        <ul>
          <li>typowo <code>work_mode = self_use</code>,</li>
          <li>nastawienie na autokonsumpcjÄ™,</li>
          <li>bez Å‚adowania z sieci (<code>charge_from_grid = false</code>).</li>
        </ul>
      </li>
      <li>
        <strong>ARBITRAÅ»</strong> â€“ sprzedaÅ¼, gdy drogo:
        <ul>
          <li>typowo <code>work_mode = feed_in</code>,</li>
          <li><code>selling_first = true</code>,</li>
          <li>wykorzystywany, gdy ceny sprzedaÅ¼y przekraczajÄ… okreÅ›lony prÃ³g (patrz
            sekcja <code>[logic_arbitrage]</code>).</li>
        </ul>
      </li>
      <li>
        <strong>ÅADOWANIE</strong> â€“ Å‚adowanie z sieci, gdy tanio:
        <ul>
          <li>typowo <code>charge_from_grid = true</code>,</li>
          <li>uÅ¼ywany, gdy ceny zakupu spadajÄ… poniÅ¼ej ustawionego progu
            (patrz sekcja <code>[logic_charge]</code>).</li>
        </ul>
      </li>
    </ul>

    <h2>6. Logika arbitraÅ¼u â€“ [logic_arbitrage]</h2>
    <p>
      Ta sekcja opisuje, kiedy system ma wejÅ›Ä‡ w tryb ARBITRAÅ» na podstawie
      cen sprzedaÅ¼y energii.
    </p>
    <ul>
      <li>
        <code>bands_for_arbitrage</code><br>
        Lista etykiet cenowych (np. <code>a,b,c,d</code>), ktÃ³re sÄ… traktowane
        jako â€wystarczajÄ…co drogieâ€, by rozwaÅ¼yÄ‡ arbitraÅ¼. Typowo:
        <ul>
          <li><code>d</code> â€“ tylko najwyÅ¼sza banda cenowa,</li>
          <li><code>c,d</code> â€“ dwie najwyÅ¼sze, jeÅ›li chcemy czÄ™Å›ciej sprzedawaÄ‡.</li>
        </ul>
      </li>
      <li>
        <code>ref_source</code><br>
        Å¹rÃ³dÅ‚o ceny referencyjnej (np. <code>avg_a</code>). W uproszczonej logice
        jest mniej krytyczne, ale zostaje jako potencjaÅ‚ do dalszego rozwoju
        algorytmu.
      </li>
      <li>
        <code>min_total_price_for_arbitrage</code><br>
        Minimalna cena sprzedaÅ¼y (w zÅ‚/kWh), powyÅ¼ej ktÃ³rej tryb ARBITRAÅ»
        jest w ogÃ³le rozwaÅ¼any. PrzykÅ‚ad:
        <ul>
          <li>0.80 â€“ wchodzimy w arbitraÅ¼ tylko, gdy cena â‰¥ 0,80 zÅ‚/kWh,</li>
          <li>puste pole â€“ arbitraÅ¼ zaleÅ¼y tylko od bandy (np. tylko â€dâ€).</li>
        </ul>
      </li>
    </ul>

    <h2>7. Logika Å‚adowania â€“ [logic_charge]</h2>
    <p>
      Sekcja opisuje, kiedy warto wejÅ›Ä‡ w tryb ÅADOWANIE, czyli Å‚adowaÄ‡ bateriÄ™
      z sieci, gdy jest tanio.
    </p>
    <ul>
      <li>
        <code>bands_for_charge</code><br>
        Lista etykiet cenowych, ktÃ³re traktujemy jako â€tanieâ€.
        Typowo:
        <ul>
          <li><code>a</code> â€“ tylko najtaÅ„sza banda,</li>
          <li><code>a,b</code> â€“ dwie najtaÅ„sze.</li>
        </ul>
      </li>
      <li>
        <code>max_total_price_for_charge</code><br>
        Maksymalna cena zakupu (w zÅ‚/kWh), przy ktÃ³rej jeszcze opÅ‚aca siÄ™
        Å‚adowaÄ‡ bateriÄ™ z sieci. JeÅ›li puste â€“ decyzja opiera siÄ™ tylko
        na bandach.
      </li>
      <li>
        <code>soc_target_charge</code><br>
        Docelowy poziom naÅ‚adowania baterii w trybie ÅADOWANIE
        (np. 90â€“95%). MoÅ¼e byÄ‡ wykorzystany do tego, Å¼eby nie przeÅ‚adowywaÄ‡
        baterii ponad zdrowy poziom.
      </li>
      <li>
        <code>soc_critical_low</code><br>
        Krytycznie niski poziom SoC, poniÅ¼ej ktÃ³rego Å‚adowanie z sieci
        moÅ¼e byÄ‡ wymuszone lub nie naleÅ¼y dopuszczaÄ‡ do dalszego rozÅ‚adowania.
      </li>
    </ul>

    <h2>8. Logika awaryjna â€“ [logic_fallback]</h2>
    <p>
      Ta sekcja odpowiada za zachowanie systemu, gdy ceny nie speÅ‚niajÄ…
      kryteriÃ³w arbitraÅ¼u ani Å‚adowania:
    </p>
    <ul>
      <li>
        <code>fallback_to_normal_if_no_match</code><br>
        JeÅ›li <code>true</code> â€“ gdy Å¼aden tryb (ARBITRAÅ» ani ÅADOWANIE)
        nie zostaÅ‚ wybrany, system wraca do trybu NORMAL.
      </li>
      <li>
        <code>soc_fallback_from_arbitrage</code><br>
        Poziom SoC, poniÅ¼ej ktÃ³rego nie ma sensu utrzymywaÄ‡ trybu ARBITRAÅ»
        i lepiej wrÃ³ciÄ‡ do NORMAL. Chroni to bateriÄ™ przed nadmiernym
        rozÅ‚adowaniem tylko dlatego, Å¼e cena jest wysoka.
      </li>
    </ul>

    <h2>9. Typowy scenariusz uÅ¼ycia</h2>
    <ol>
      <li>Uruchom <code>battery_modes_g14_gui.py</code> na komputerze z dostÄ™pem do NAS.</li>
      <li>Na zakÅ‚adce OGÃ“LNE ustaw:
        <ul>
          <li>aktywnÄ… taryfÄ™ (<code>g13</code> lub <code>g14</code>),</li>
          <li>wÅ‚Ä…cz / wyÅ‚Ä…cz <code>send_to_solax</code>,</li>
          <li>ewentualnie <code>debug</code> oraz <code>season_mode</code>.</li>
        </ul>
      </li>
      <li>Na zakÅ‚adkach NORMAL, ARBITRAÅ», ÅADOWANIE ustaw:
        <ul>
          <li><code>soc_min</code> i <code>soc_target</code>,</li>
          <li>okna czasowe rozÅ‚adowywania / Å‚adowania,</li>
          <li>flagi <code>selling_first</code> i <code>charge_from_grid</code>.</li>
        </ul>
      </li>
      <li>Na zakÅ‚adce LOGIKA dopasuj:
        <ul>
          <li>bande cenowe i progi dla arbitraÅ¼u,</li>
          <li>bande cenowe i progi dla Å‚adowania,</li>
          <li>parametry fallbacku.</li>
        </ul>
      </li>
      <li>NaciÅ›nij â€Save INIâ€.</li>
      <li>Uruchom harmonogram / skrypt
        <code>utility_03_set_up_solax_g14.py</code>, ktÃ³ry na podstawie cen
        wybierze odpowiedni tryb i (jeÅ›li to wÅ‚Ä…czone) wyÅ›le komendy do Solaxa.</li>
    </ol>

    <h2>10. Uwaga bezpieczeÅ„stwa</h2>
    <p>
      Zanim ustawisz <code>send_to_solax = true</code>:
    </p>
    <ul>
      <li>przetestuj logikÄ™ przy <code>send_to_solax = false</code>,</li>
      <li>sprawdÅº w plikach CSV, jakie komendy sÄ… generowane
        (szczegÃ³lnie rejestry SoC i tryby pracy),</li>
      <li>zaczynaj od ostroÅ¼nych wartoÅ›ci <code>soc_min</code> i
        <code>soc_critical_low</code>, aby nie rozÅ‚adowaÄ‡ baterii zbyt gÅ‚Ä™boko.</li>
    </ul>
    <p>
      Ten konfigurator daje duÅ¼Ä… elastycznoÅ›Ä‡ â€“ co jest zaletÄ…, ale wymaga teÅ¼
      Å›wiadomego uÅ¼ycia. JeÅ›li zmieniasz wiÄ™cej niÅ¼ jeden parametr naraz,
      rÃ³b to etapami i obserwuj zachowanie instalacji.
    </p>
  </section>

</main>
<script src="assets/js/metro.js"></script>
</body>
</html>
